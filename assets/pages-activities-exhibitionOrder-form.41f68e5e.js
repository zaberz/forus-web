import{a7 as e,V as l,ag as a,ah as t,o as s,c as o,w as u,i as n,a as d,b as r,t as i,d as c,r as f,F as m,j as x,H as b,ai as p,D as v,z as h,aj as _,I as g,af as y}from"./index-401430b3.js";import{d as k}from"./dayjs.min.e0aede96.js";import{a as w,u as N}from"./index.f345a6f0.js";import{p as C}from"./login.a0f9f7ef.js";import{a as V}from"./setting.ef12ace8.js";const j={__name:"form",setup(j){const D=e({time:"",childNum:0,phone:"",lastName:"",firstName:"",gender:""});async function M(){if(!function(){let e=D.value,l="";e.time?e.phone?e.firstName&&e.lastName||(l="请填写姓名"):l="请授权手机号":l="请选择时间";if(l)return v({title:l,icon:"none"}),!1;return!0}())return;let e={...D.value,customer:l.value.id},a=(await p(e)).id;v({icon:"success",title:"预约成功"}),h({url:`/pages/activities/exhibitionOrder/result?id=${a}`})}w(l.subscribe((e=>{e.wxPhone&&(D.value.phone=e.wxPhone)})));const P=e(!1);function Y(){P.value=!0}const z=e([]),U=e({}),G=e({});function I(){D.value.time=G.value.id,P.value=!1}function R(e){"plus"==e?D.value.childNum=Math.min(D.value.childNum+1,9):"minus"==e&&(D.value.childNum=Math.max(D.value.childNum-1,0))}a((()=>{!async function(){let e=await t();z.value=e.map((e=>({...e,date:k(e.date).format("MM月DD日")})))}()})),k().format("YYYY-MM-DD");const $=N(V);async function E(e){if(!e.detail||!e.detail.code)return void v({title:"请授权手机号",icon:"error"});let a=(await _({url:"https://auth.ruaaaa.com/phone",params:{code:e.detail.code,appid:$.value}})).phone_info.phoneNumber;D.value.phone=a,l.next({...l.value,wxPhone:a}),C(l.value,{wxPhone:a})}return(e,l)=>{const a=n,t=g,p=y;return s(),o(a,{class:"text-center"},{default:u((()=>[d(a,{class:"h-12"}),d(a,{class:"outline outline-offset-2 outline-1 border border-solid border-black px-4 py-1 text-center text-xl font-bold inline-block mx-auto"},{default:u((()=>[r(" 预约展览 ")])),_:1}),d(a,{class:"mt-8 px-6 text-left width-full"},{default:u((()=>[U.value.date?(s(),o(a,{key:1,class:"border-b border-solid pb-1",onClick:Y},{default:u((()=>[r(i(U.value.date)+" "+i(G.value.timeRange),1)])),_:1})):(s(),o(a,{key:0,class:"text-gray-500 border-b border-solid pb-1",onClick:Y},{default:u((()=>[r("请选择日期和时间*")])),_:1})),P.value?(s(),o(a,{key:2,class:"fixed top-0 left-0 z-10 flex h-screen w-screen items-end"},{default:u((()=>[d(a,{onClick:l[0]||(l[0]=e=>P.value=!1),class:"absolute top-0 right-0 bottom-0 left-0 bg-blacks80"}),d(a,{class:"relative z-10 w-full bg-white"},{default:u((()=>[d(a,{class:"grid grid-cols-4 gap-y-4 px-6 py-6 text-center"},{default:u((()=>[(s(!0),c(m,null,f(z.value,(e=>(s(),o(a,{class:b([{"text-blue-800":U.value.date==e.date},""]),onClick:l=>U.value=e,key:e.date},{default:u((()=>[r(i(e.date),1)])),_:2},1032,["class","onClick"])))),128))])),_:1}),d(a,{class:"mt-4 grid grid-cols-4 gap-y-4 border-y border-solid border-gray-300 px-6 py-6 text-center"},{default:u((()=>[U.value.date?(s(!0),c(m,{key:1},f(U.value.time,(e=>(s(),o(a,{key:e,class:b([{"text-blue-800":G.value.id==e.id,"text-gray-500":e.disable,"line-through\t":e.disable},""]),onClick:l=>{var a;(a=e).disable||(G.value=a,D.value.time=a.id)}},{default:u((()=>[r(i(e.timeRange),1)])),_:2},1032,["class","onClick"])))),128)):(s(),o(a,{key:0},{default:u((()=>[r("请选择日期")])),_:1}))])),_:1}),d(a,{onClick:I,class:"mt-4 text-center underline underline-offset-4"},{default:u((()=>[r("确认")])),_:1}),d(a,{style:{height:"env(safe-area-inset-bottom)"},class:""})])),_:1})])),_:1})):x("v-if",!0)])),_:1}),d(a,{class:"flex justify-between px-6 mt-6"},{default:u((()=>[d(a,{class:"flex-1 text-left"},{default:u((()=>[r("展览陪同人数")])),_:1}),d(a,{class:"flex item-center"},{default:u((()=>[d(a,{class:"px-4",onClick:l[1]||(l[1]=e=>R("minus"))},{default:u((()=>[r("-")])),_:1}),d(a,{class:"mx-2 w-8 text-center bg-gray-100"},{default:u((()=>[r(i(D.value.childNum),1)])),_:1}),d(a,{class:"px-4",onClick:l[2]||(l[2]=e=>R("plus"))},{default:u((()=>[r("+")])),_:1})])),_:1})])),_:1}),d(a,{class:"mt-20 outline outline-offset-2 outline-1 border border-solid border-black px-4 py-1 text-center text-xl font-bold inline-block mx-auto"},{default:u((()=>[r(" 预约信息")])),_:1}),d(a,{class:"px-6 text-left"},{default:u((()=>[d(a,{class:"flex border-b border-solid mt-8"},{default:u((()=>[d(t,{class:"flex-1",modelValue:D.value.phone,"onUpdate:modelValue":l[3]||(l[3]=e=>D.value.phone=e),placeholder:"手机号码*",type:"text"},null,8,["modelValue"]),x('        <view class="flex-1 text-gray-500">'),x("          {{formData.phone ? `手机号码:${formData.phone}` : '手机号码*'}}"),x("        </view>"),x("        <button>"),x('          @click="onGetPhoneNumber"'),x("        </button>"),D.value.phone?x("v-if",!0):(s(),o(p,{key:0,"open-type":"getPhoneNumber",onGetphonenumber:E,class:"underline underline-offset-2 text-sm"},{default:u((()=>[r("微信手机号验证")])),_:1}))])),_:1}),d(a,{class:"flex gap-4 mt-6"},{default:u((()=>[d(a,{class:"flex-1 border-b border-solid"},{default:u((()=>[d(t,{modelValue:D.value.firstName,"onUpdate:modelValue":l[4]||(l[4]=e=>D.value.firstName=e),type:"text",placeholder:"姓*"},null,8,["modelValue"])])),_:1}),d(a,{class:"flex-1 border-b border-solid"},{default:u((()=>[d(t,{modelValue:D.value.lastName,"onUpdate:modelValue":l[5]||(l[5]=e=>D.value.lastName=e),type:"text",placeholder:"名*"},null,8,["modelValue"])])),_:1})])),_:1}),d(a,{class:"mt-8 flex"},{default:u((()=>[d(a,{onClick:l[6]||(l[6]=e=>D.value.gender=2),class:"flex item-center"},{default:u((()=>[d(a,{class:b([{"bg-black":2==D.value.gender},"w-4 h-4 border border-solid"])},null,8,["class"]),d(a,{class:"ml-2"},{default:u((()=>[r("女")])),_:1})])),_:1}),d(a,{onClick:l[7]||(l[7]=e=>D.value.gender=1),class:"flex item-center ml-8"},{default:u((()=>[d(a,{class:b([{"bg-black":1==D.value.gender},"w-4 h-4 border border-solid"])},null,8,["class"]),d(a,{class:"ml-2"},{default:u((()=>[r("男")])),_:1})])),_:1})])),_:1})])),_:1}),d(a,{class:"underline underline-offset-4 text-center mt-12",onClick:M},{default:u((()=>[r(" 预约 ")])),_:1}),d(a,{class:"text-gray-600 text-xs text-center mt-4"},{default:u((()=>[r("(此页面预约为展览参观,非试纱档期,如需试纱档期请联系客服预约)")])),_:1})])),_:1})}}};export{j as default};
